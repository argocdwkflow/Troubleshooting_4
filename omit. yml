- name: "RHSM | Register (safe, NO shell, single call)"
  ansible.builtin.command:
    argv:
      - subscription-manager
      - register
      - "--activationkey={{ satellite_register_ak }}"
      - "--org={{ satellite_register_org }}"
      - "{{ (satellite_register_force | default(false)) | ternary('--force', omit) }}"
  register: rhsm_register
  failed_when: rhsm_register.rc != 0
  changed_when: "'The system has been registered' in (rhsm_register.stdout | default(''))"