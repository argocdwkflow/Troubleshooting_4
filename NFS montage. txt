An NFS hang occurs when the Linux kernel blocks indefinitely waiting for NFS server responses, placing processes in uninterruptible sleep (D-state). This condition cannot be resolved by killing processes and often requires lazy unmount or server reboot. Proper mitigation includes systemd automount, network-aware mounts, and correct hard/soft configuration.

nfs-server:/export/data  /data  nfs4  \
_netdev,x-systemd.automount,noatime,hard,timeo=600,retrans=5,rsize=1048576,wsize=1048576  0  0

Voici les options de montage NFS les plus recommandÃ©es en production, basÃ©es sur retour terrain (MQ, Oracle, SAP, logs, batchs) et bonnes pratiques Red Hat / systemd.
Je te donne le â€œgold standardâ€, puis des variantes selon lâ€™usage.
â­ Gold standard â€“ NFS robuste (recommandÃ© par dÃ©faut)
Copy code
Fstab
nfs-server:/export/data  /data  nfs4  \
_netdev,x-systemd.automount,noatime,hard,timeo=600,retrans=5,rsize=1048576,wsize=1048576  0  0
Pourquoi câ€™est le meilleur compromis
pas de blocage au boot
auto-rÃ©cupÃ©ration aprÃ¨s coupure rÃ©seau
intÃ©gritÃ© des donnÃ©es
bonnes performances
compatible Ansible / systemd
ğŸ§© DÃ©tail des options (important)
Option
Recommandation
Pourquoi
nfs4
âœ… obligatoire
moins de ports, plus stable
_netdev
âœ… obligatoire
attend le rÃ©seau
x-systemd.automount
âœ… obligatoire
Ã©vite hang global
hard
âœ… donnÃ©es critiques
pas de corruption
soft
âš ï¸ logs uniquement
jamais de blocage
timeo=600
âœ…
timeout maÃ®trisÃ©
retrans=5
âœ…
limite retries
noatime
âœ…
rÃ©duit I/O
rsize/wsize=1M
âœ…
performance
bg
âŒ inutile avec systemd
legacy
intr
âŒ obsolÃ¨te
ignorÃ© en NFSv4
ğŸ¯ Profils par usage (IMPORTANT)
ğŸ”’ MQ / Oracle / SAP (CRITIQUE)
Copy code
Fstab
nfs-server:/mq  /var/mqm  nfs4  \
_netdev,x-systemd.automount,hard,noatime,timeo=600,retrans=5  0  0
âœ”ï¸ intÃ©gritÃ© garantie
âœ”ï¸ recovery automatique
âŒ sans automount = risque de hang
ğŸ“„ Logs / backups / archives
Copy code
Fstab
nfs-server:/logs  /logs  nfs4  \
_netdev,x-systemd.automount,soft,noatime,timeo=300,retrans=3  0  0
âœ”ï¸ jamais bloquant
âœ”ï¸ tolÃ¨re perte rÃ©seau
âŒ possible perte dâ€™Ã©critures
âš¡ Batch / traitements non critiques
Copy code
Fstab
_netdev,x-systemd.automount,hard,noatime,timeo=300,retrans=3
ğŸš« Options Ã  Ã©viter ABSOLUMENT
Copy code
Text
defaults
bg
nolock
intr
retry=0
â¡ï¸ hÃ©ritage NFSv3 / SysV
â¡ï¸ causes frÃ©quentes de hang
ğŸ§ª VÃ©rification aprÃ¨s montage
Copy code
Bash
findmnt -o TARGET,SOURCE,FSTYPE,OPTIONS /data
systemctl status data.automount
ğŸ§¾ Phrase prÃªte ServiceNow / Audit
NFS mounts were hardened using systemd automount and network-aware options. The configuration prevents boot blocking, ensures automatic recovery after network disruptions, and maintains data integrity for critical workloads.
ğŸ§  RÃ¨gle dâ€™or (Ã  retenir)
Hard + automount = sÃ»r
Soft sans donnÃ©es critiques
Jamais de NFS bloquant au boot
Si tu veux :
je valide tes lignes fstab existantes
je fais un check automatique Ansible
je te prÃ©pare une baseline NFS pour ton parc RHEL
Dis-moi ğŸ‘