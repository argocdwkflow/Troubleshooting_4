Oui üëç on peut faire exactement la m√™me chose, mais adapt√©e √† TON cas r√©el (dg / vol / mount / chemins imbriqu√©s), comme sur la capture, et je vais le faire proprement, N3, pr√™t √† ex√©cuter.
Je vais prendre un exemple concret de ton environnement, et tu pourras le d√©cliner pour les autres FS.
üéØ Hypoth√®se (bas√©e sur tes captures)
DiskGroup : dg_prod3_pkg5
Service Group : acetp_prod3_pkg5-SG
Volume : lv_storage_prod3_itrp
Mount point :
/applis/AP02807-ATP00_phalanger/storage_prod3_itrp
Taille : 20G
FS : vxfs
1Ô∏è‚É£ Cr√©ation du volume + filesystem (VxVM)
Copy code
Bash
vxassist -b -g dg_prod3_pkg5 make lv_storage_prod3_itrp 20G
Copy code
Bash
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_storage_prod3_itrp
‚úÖ -b : allocation contigu√´
‚úÖ mkfs sur rdsk : bonne pratique
2Ô∏è‚É£ Cr√©ation des r√©pertoires (ordre imbriqu√©)
Copy code
Bash
mkdir -p /applis/AP02807-ATP00_phalanger/storage_prod3_itrp
3Ô∏è‚É£ Ressource VOLUME dans VCS
Copy code
Bash
hares -add acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL Volume acetp_prod3_pkg5-SG
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL Volume lv_storage_prod3_itrp
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL DiskGroup dg_prod3_pkg5
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL Enabled 1
4Ô∏è‚É£ Ressource MOUNT dans VCS (comme sur ta capture)
Copy code
Bash
hares -add acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT Mount acetp_prod3_pkg5-SG
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT FSType vxfs
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT FsckOpt "-y"
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT MountPoint "/applis/AP02807-ATP00_phalanger/storage_prod3_itrp"
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT BlockDevice "/dev/vx/dsk/dg_prod3_pkg5/lv_storage_prod3_itrp"
üîê Options critiques (IDENTIQUES √† ta capture)
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT RecursiveMnt 0
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT BindUmount 1
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT CkptUmount 1
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT SnapUmount 0
üî• POINT CL√â ‚Äì VxFSMountLock (OBLIGATOIRE)
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT VxFSMountLock 1
‚úÖ Protection anti double-mount
‚úÖ S√©curit√© cluster
‚úÖ Exactement comme sur ta capture
Copy code
Bash
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT Enabled 1
5Ô∏è‚É£ D√©pendances (‚ö†Ô∏è TR√àS IMPORTANT)
VOL d√©pend du DiskGroup
Copy code
Bash
hares -link acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL acetp_prod3_pkg5-DG
MOUNT d√©pend du VOL
Copy code
Bash
hares -link acetp_prod3_pkg5-lv_storage_prod3_itrp-MOUNT acetp_prod3_pkg5-lv_storage_prod3_itrp-VOL
6Ô∏è‚É£ Ordre final VCS (clean N3)
Copy code

DG
 ‚îî‚îÄ‚îÄ VOL
      ‚îî‚îÄ‚îÄ MOUNT
7Ô∏è‚É£ V√©rifications finales
Copy code
Bash
hares -display acetp_prod3_pkg5-SG | egrep "VOL|MOUNT|DG"
Copy code
Bash
hagrp -online acetp_prod3_pkg5-SG -sys <node>
Copy code
Bash
df -h | grep storage_prod3_itrp
‚úÖ Verdict
‚úîÔ∏è M√™me logique que ta capture
‚úîÔ∏è M√™me niveau de s√©curit√©
‚úîÔ∏è Conforme Veritas / VCS
‚úîÔ∏è Pr√™t pour PROD / PREPROD
üëâ Si tu veux, je peux maintenant :
üîÅ te faire TOUS les FS (comms / logs / data / batch) en une seule fois
üìÑ te g√©n√©rer un runbook officiel
üß© te faire un script semi-automatis√©
Dis-moi üí™





OK ‚úÖ Je te g√©n√®re le runbook complet ‚Äúcomme la capture‚Äù pour tous les FS imbriqu√©s, avec VOL + MOUNT + d√©pendances.
Je te le fais pour les 2 DG de tes demandes :
dg_prod1_pkg2 / SG acetp_prod1_pkg2-SG
dg_prod3_pkg5 / SG acetp_prod3_pkg5-SG
‚ö†Ô∏è Hypoth√®se : tu as d√©j√† une ressource DiskGroup dans chaque SG, nomm√©e acetp_prod1_pkg2-DG et acetp_prod3_pkg5-DG.
Si le nom diff√®re, tu remplaces juste ce nom dans les hares -link ... -DG.
A) PROD1 ‚Äî dg_prod1_pkg2 (FS imbriqu√©s)
A1) Cr√©ation VxVM + mkfs + mkdir
Copy code
Bash
# Volumes
vxassist -b -g dg_prod1_pkg2 make lv_prod1_comms        50g
vxassist -b -g dg_prod1_pkg2 make lv_prod1_comms_logs   10g
vxassist -b -g dg_prod1_pkg2 make lv_prod1_comms_data   50g
vxassist -b -g dg_prod1_pkg2 make lv_prod1_itrp         20g
vxassist -b -g dg_prod1_pkg2 make lv_prod1_batch        15g
vxassist -b -g dg_prod1_pkg2 make lv_prod1_batch_logs   10g

# Filesystems (rdsk)
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_comms
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_comms_logs
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_comms_data
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_itrp
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_batch
mkfs.vxfs /dev/vx/rdsk/dg_prod1_pkg2/lv_prod1_batch_logs

# Directories (ordre imbriqu√©)
mkdir -p /applis/AP02807-ATP00_comms/prod1-comms/{logs,data}
mkdir -p /applis/AP02807-ATP00_phalanger/storage_prod1_itrp
mkdir -p /applis/AP02807-ATP00_batch/prod1-batch/logs
A2) D√©claration VCS ‚Äî VOL + MOUNT + d√©pendances (comme ta capture)
1) COMM S parent (50G)
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_comms-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms-VOL Volume   lv_prod1_comms
hares -modify acetp_prod1_pkg2-lv_prod1_comms-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_comms-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_comms-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_comms-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT MountPoint "/applis/AP02807-ATP00_comms/prod1-comms"
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_comms"
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_comms-MOUNT acetp_prod1_pkg2-lv_prod1_comms-VOL
2) COMM logs (10G) ‚Äî d√©pend du parent mount
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_comms_logs-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-VOL Volume   lv_prod1_comms_logs
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_comms_logs-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT MountPoint "/applis/AP02807-ATP00_comms/prod1-comms/logs"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_comms_logs"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT acetp_prod1_pkg2-lv_prod1_comms_logs-VOL
hares -link   acetp_prod1_pkg2-lv_prod1_comms_logs-MOUNT acetp_prod1_pkg2-lv_prod1_comms-MOUNT
3) COMM data (50G) ‚Äî d√©pend du parent mount
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_comms_data-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-VOL Volume   lv_prod1_comms_data
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_comms_data-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT MountPoint "/applis/AP02807-ATP00_comms/prod1-comms/data"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_comms_data"
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT acetp_prod1_pkg2-lv_prod1_comms_data-VOL
hares -link   acetp_prod1_pkg2-lv_prod1_comms_data-MOUNT acetp_prod1_pkg2-lv_prod1_comms-MOUNT
4) ITRP storage (20G)
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_itrp-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-VOL Volume   lv_prod1_itrp
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_itrp-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_itrp-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT MountPoint "/applis/AP02807-ATP00_phalanger/storage_prod1_itrp"
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_itrp"
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_itrp-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_itrp-MOUNT acetp_prod1_pkg2-lv_prod1_itrp-VOL
5) BATCH parent (15G)
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_batch-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_batch-VOL Volume   lv_prod1_batch
hares -modify acetp_prod1_pkg2-lv_prod1_batch-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_batch-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_batch-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_batch-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT MountPoint "/applis/AP02807-ATP00_batch/prod1-batch"
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_batch"
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_batch-MOUNT acetp_prod1_pkg2-lv_prod1_batch-VOL
6) BATCH logs (10G) ‚Äî d√©pend du parent mount
Copy code
Bash
# VOL
hares -add    acetp_prod1_pkg2-lv_prod1_batch_logs-VOL Volume acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-VOL Volume   lv_prod1_batch_logs
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-VOL DiskGroup dg_prod1_pkg2
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-VOL Enabled 1
hares -link   acetp_prod1_pkg2-lv_prod1_batch_logs-VOL acetp_prod1_pkg2-DG

# MOUNT
hares -add    acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT Mount acetp_prod1_pkg2-SG
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT FSType vxfs
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT FsckOpt "-y"
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT MountPoint "/applis/AP02807-ATP00_batch/prod1-batch/logs"
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT BlockDevice "/dev/vx/dsk/dg_prod1_pkg2/lv_prod1_batch_logs"
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT RecursiveMnt 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT BindUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT CkptUmount 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT SnapUmount 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT VxFSMountLock 1
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT Enabled 1

hares -link   acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT acetp_prod1_pkg2-lv_prod1_batch_logs-VOL
hares -link   acetp_prod1_pkg2-lv_prod1_batch_logs-MOUNT acetp_prod1_pkg2-lv_prod1_batch-MOUNT
B) PROD3 ‚Äî dg_prod3_pkg5 (m√™me logique)
Tu dupliques exactement, en rempla√ßant prod1 ‚Üí prod3 et dg_prod1_pkg2 ‚Üí dg_prod3_pkg5, acetp_prod1_pkg2-SG ‚Üí acetp_prod3_pkg5-SG.
Pour aller vite, voici le bloc ‚Äúcr√©ation volumes + mkfs + mkdir‚Äù :
Copy code
Bash
vxassist -b -g dg_prod3_pkg5 make lv_prod3_comms        50g
vxassist -b -g dg_prod3_pkg5 make lv_prod3_comms_logs   10g
vxassist -b -g dg_prod3_pkg5 make lv_prod3_comms_data   50g
vxassist -b -g dg_prod3_pkg5 make lv_prod3_itrp         20g
vxassist -b -g dg_prod3_pkg5 make lv_prod3_batch        15g
vxassist -b -g dg_prod3_pkg5 make lv_prod3_batch_logs   10g

mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_comms
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_comms_logs
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_comms_data
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_itrp
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_batch
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_batch_logs

mkdir -p /applis/AP02807-ATP00_comms/prod3-comms/{logs,data}
mkdir -p /applis/AP02807-ATP00_phalanger/storage_prod3_itrp
mkdir -p /applis/AP02807-ATP00_batch/prod3-batch/logs
C) V√©rifs finales (cluster)
Copy code
Bash
# V√©rifier ressources
hares -display acetp_prod1_pkg2-SG | egrep "DG|VOL|MOUNT"
hares -display acetp_prod3_pkg5-SG | egrep "DG|VOL|MOUNT"

# Online SG sur le node actif
hagrp -online  acetp_prod1_pkg2-SG -sys <node>
hagrp -online  acetp_prod3_pkg5-SG -sys <node>

# V√©rifier montages
df -h | egrep "prod1-comms|prod1-batch|storage_prod1_itrp|prod3-comms|prod3-batch|storage_prod3_itrp"
Si tu m‚Äôenvoies le nom exact des ressources DG dans tes SG (ex: dg_prod1_pkg2-res ou autre) + si tu veux un naming identique √† votre standard (pr√©fixes exacts), je te renvoie une version 100% conforme √† ton cluster, sans aucune hypoth√®se.


OK ‚úÖ m√™me logique que ta capture = on fait pour chaque FS :
vxassist -b -g <DG> make <VOL> <SIZE>
mkfs.vxfs /dev/vx/rdsk/<DG>/<VOL>
mkdir -p <MOUNTPOINT>
hares -add ...-VOL + hares -modify (Volume/DiskGroup/Enabled)
hares -add ...-MOUNT + hares -modify (FSType/FsckOpt/MountPoint/BlockDevice/Options/VxFSMountLock/Enabled)
hares -link MOUNT -> VOL
si dossier imbriqu√©: hares -link child-MOUNT -> parent-MOUNT
hares -link VOL -> <DG_RESOURCE> (si votre SG a une ressource DG)
Je te donne ci-dessous un template unique (copier/coller) + un exemple complet sur ton cas.
1) Template ‚ÄúFS standard‚Äù (VOL + MOUNT) ‚Äî m√™me logique
Remplace : <SG> <DG> <VOL> <SIZE> <MP> <DG_RES>
Copy code
Bash
# --- VxVM ---
vxassist -b -g <DG> make <VOL> <SIZE>
mkfs.vxfs /dev/vx/rdsk/<DG>/<VOL>
mkdir -p "<MP>"

# --- VCS VOL ---
hares -add    <SG>-<VOL>-VOL Volume <SG>
hares -modify <SG>-<VOL>-VOL Volume   <VOL>
hares -modify <SG>-<VOL>-VOL DiskGroup <DG>
hares -modify <SG>-<VOL>-VOL Enabled 1
hares -link   <SG>-<VOL>-VOL <DG_RES>

# --- VCS MOUNT ---
hares -add    <SG>-<VOL>-MOUNT Mount <SG>
hares -modify <SG>-<VOL>-MOUNT FSType vxfs
hares -modify <SG>-<VOL>-MOUNT FsckOpt "-y"
hares -modify <SG>-<VOL>-MOUNT MountPoint "<MP>"
hares -modify <SG>-<VOL>-MOUNT BlockDevice "/dev/vx/dsk/<DG>/<VOL>"
hares -modify <SG>-<VOL>-MOUNT RecursiveMnt 0
hares -modify <SG>-<VOL>-MOUNT BindUmount 1
hares -modify <SG>-<VOL>-MOUNT CkptUmount 1
hares -modify <SG>-<VOL>-MOUNT SnapUmount 0
hares -modify <SG>-<VOL>-MOUNT VxFSMountLock 1
hares -modify <SG>-<VOL>-MOUNT CreateRestoreAccess 0
hares -modify <SG>-<VOL>-MOUNT Enabled 1

# --- Dependency ---
hares -link   <SG>-<VOL>-MOUNT <SG>-<VOL>-VOL
Si mount imbriqu√© (child sous parent)
Ajoute juste :
Copy code
Bash
hares -link <SG>-<VOL_CHILD>-MOUNT <SG>-<VOL_PARENT>-MOUNT
2) Exemple COMPLET (prod3 / dg_prod3_pkg5 / m√™me logique)
FS parent: /applis/.../prod3-comms 50G
Copy code
Bash
vxassist -b -g dg_prod3_pkg5 make lv_prod3_comms 50g
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_comms
mkdir -p "/applis/AP02807-ATP00_comms/prod3-comms"

hares -add    acetp_prod3_pkg5-SG-lv_prod3_comms-VOL Volume acetp_prod3_pkg5-SG
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-VOL Volume   lv_prod3_comms
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-VOL DiskGroup dg_prod3_pkg5
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-VOL Enabled 1
hares -link   acetp_prod3_pkg5-SG-lv_prod3_comms-VOL acetp_prod3_pkg5-DG

hares -add    acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT Mount acetp_prod3_pkg5-SG
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT FSType vxfs
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT FsckOpt "-y"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT MountPoint "/applis/AP02807-ATP00_comms/prod3-comms"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT BlockDevice "/dev/vx/dsk/dg_prod3_pkg5/lv_prod3_comms"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT RecursiveMnt 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT BindUmount 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT CkptUmount 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT SnapUmount 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT VxFSMountLock 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT Enabled 1
hares -link   acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT acetp_prod3_pkg5-SG-lv_prod3_comms-VOL
FS child: /.../prod3-comms/logs 10G (imbriqu√©)
Copy code
Bash
vxassist -b -g dg_prod3_pkg5 make lv_prod3_comms_logs 10g
mkfs.vxfs /dev/vx/rdsk/dg_prod3_pkg5/lv_prod3_comms_logs
mkdir -p "/applis/AP02807-ATP00_comms/prod3-comms/logs"

hares -add    acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL Volume acetp_prod3_pkg5-SG
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL Volume   lv_prod3_comms_logs
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL DiskGroup dg_prod3_pkg5
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL Enabled 1
hares -link   acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL acetp_prod3_pkg5-DG

hares -add    acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT Mount acetp_prod3_pkg5-SG
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT FSType vxfs
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT FsckOpt "-y"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT MountPoint "/applis/AP02807-ATP00_comms/prod3-comms/logs"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT BlockDevice "/dev/vx/dsk/dg_prod3_pkg5/lv_prod3_comms_logs"
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT RecursiveMnt 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT BindUmount 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT CkptUmount 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT SnapUmount 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT VxFSMountLock 1
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT CreateRestoreAccess 0
hares -modify acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT Enabled 1
hares -link   acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT acetp_prod3_pkg5-SG-lv_prod3_comms_logs-VOL

# d√©pendance imbriqu√©e : logs d√©pend du parent prod3-comms
hares -link   acetp_prod3_pkg5-SG-lv_prod3_comms_logs-MOUNT acetp_prod3_pkg5-SG-lv_prod3_comms-MOUNT
üëâ M√™me chose pour data, batch, batch/logs, storage_prod3_itrp, etc.
3) Deux check rapides pour √©viter la casse
V√©rifier que la ressource DG existe (sinon on link pas)
Copy code
Bash
hares -display acetp_prod3_pkg5-SG | grep -i diskgroup
V√©rifier l‚Äôordre de d√©pendances
Copy code
Bash
hagrp -dep acetp_prod3_pkg5-SG
Si tu me confirmes juste le nom exact de la ressource DiskGroup dans ton SG (parfois c‚Äôest DG_dg_prod3_pkg5 ou dg_prod3_pkg5_dg), je te renvoie la version 100% exacte sans placeholder, pour prod1 + prod3, tous les FS, pr√™te √† ex√©cuter.



