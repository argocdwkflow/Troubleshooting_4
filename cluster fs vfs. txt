Parfait, jâ€™ai bien compris ğŸ‘
Tu veux formaliser une demande / procÃ©dure de crÃ©ation des FS sur un cluster Veritas (VCS + VxVM + VxFS), en respectant un ordre strict des dossiers et sous-dossiers imbriquÃ©s, comme montrÃ© sur tes captures (dg_prod1_pkg2, dg_prod3_pkg5, SG online/offline, free space OK, etc.).
Je te propose une mÃ©thode propre, N3-grade, que tu peux utiliser :
soit comme procÃ©dure dâ€™exÃ©cution
soit comme demande officielle (RITM / change / mail / ticket)
1ï¸âƒ£ PrÃ©-requis VALIDÃ‰S (ce que montrent tes screenshots)
Avant toute crÃ©ation, on vÃ©rifie :
âœ”ï¸ Cluster
hastatus -sum â†’ RUNNING sur les 2 nÅ“uds
Aucun SG critique en FAULTED
Groupes concernÃ©s ONLINE sur un seul nÅ“ud (normal)
âœ”ï¸ Disk groups
vxdg list
dg_prod1_pkg2 â†’ enabled, cds
dg_prod3_pkg5 â†’ enabled, cds
âœ”ï¸ Espace disque
vxdg -u g -g <dg> free
Espace contigu suffisant pour chaque FS
ğŸ‘‰ OK dâ€™aprÃ¨s tes captures (200+ GB free)
2ï¸âƒ£ Ordre STRICT de crÃ©ation (trÃ¨s important)
âš ï¸ Toujours respecter cet ordre pour Ã©viter :
montages partiels
dÃ©pendances cassÃ©es
SG qui ne remonte pas
Ordre logique
CrÃ©er les volumes
CrÃ©er les filesystems
CrÃ©er les rÃ©pertoires parents
Monter les FS
DÃ©clarer dans VCS
Tester switch SG
3ï¸âƒ£ Exemple COMPLET â€“ dg_prod1_pkg2 (prod1)
ğŸ”¹ Volumes & FS Ã  crÃ©er
Mount point
Taille
/applis/AP02807-ATP00_comms/prod1-comms
50G
/applis/AP02807-ATP00_comms/prod1-comms/logs
10G
/applis/AP02807-ATP00_comms/prod1-comms/data
50G
/applis/AP02807-ATP00_phalanger/storage_prod1_itrp
20G
/applis/AP02807-ATP00_batch/prod1-batch
15G
/applis/AP02807-ATP00_batch/prod1-batch/logs
10G
ğŸ”¹ CrÃ©ation volumes (exemple)
Copy code
Bash
vxassist -g dg_prod1_pkg2 make vol_prod1_comms 50g
vxassist -g dg_prod1_pkg2 make vol_prod1_comms_logs 10g
vxassist -g dg_prod1_pkg2 make vol_prod1_comms_data 50g
vxassist -g dg_prod1_pkg2 make vol_prod1_itrp 20g
vxassist -g dg_prod1_pkg2 make vol_prod1_batch 15g
vxassist -g dg_prod1_pkg2 make vol_prod1_batch_logs 10g
ğŸ”¹ CrÃ©ation des FS
Copy code
Bash
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_comms
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_comms_logs
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_comms_data
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_itrp
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_batch
mkfs -t vxfs /dev/vx/rdsk/dg_prod1_pkg2/vol_prod1_batch_logs
ğŸ”¹ CrÃ©ation des rÃ©pertoires (ordre imbriquÃ©)
Copy code
Bash
mkdir -p /applis/AP02807-ATP00_comms/prod1-comms/{logs,data}
mkdir -p /applis/AP02807-ATP00_phalanger/storage_prod1_itrp
mkdir -p /applis/AP02807-ATP00_batch/prod1-batch/logs
ğŸ”¹ Montage manuel (test)
Copy code
Bash
mount -t vxfs /dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms /applis/AP02807-ATP00_comms/prod1-comms
mount -t vxfs /dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms_logs /applis/AP02807-ATP00_comms/prod1-comms/logs
mount -t vxfs /dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms_data /applis/AP02807-ATP00_comms/prod1-comms/data
mount -t vxfs /dev/vx/dsk/dg_prod1_pkg2/vol_prod1_itrp /applis/AP02807-ATP00_phalanger/storage_prod1_itrp
mount -t vxfs /dev/vx/dsk/dg_prod1_pkg2/vol_prod1_batch /applis/AP02807-ATP00_batch/prod1-batch
mount -t vxfs /dev/vx/dg_prod1_pkg2/vol_prod1_batch_logs /applis/AP02807-ATP00_batch/prod1-batch/logs
4ï¸âƒ£ DÃ©claration dans VCS (propre)
Dans le Service Group concernÃ© (acetp_prod1_pkg2-SG) :
Resource type : Mount
Attributs :
MountPoint
BlockDevice
FSType = vxfs
FsckOpt = -y
DÃ©pendance :
Mount dÃ©pend du DiskGroup
ğŸ‘‰ Ordre recommandÃ© :
Copy code

DG â†’ Volume â†’ Mount parent â†’ Mount child
5ï¸âƒ£ MÃªme logique pour dg_prod3_pkg5 (prod3)
Exactement la mÃªme procÃ©dure, en remplaÃ§ant :
prod1 â†’ prod3
dg_prod1_pkg2 â†’ dg_prod3_pkg5
SG : acetp_prod3_pkg5-SG
6ï¸âƒ£ Tests finaux obligatoires
Copy code
Bash
hagrp -offline acetp_prodX_pkgY-SG -sys <node>
hagrp -online  acetp_prodX_pkgY-SG -sys <other_node>
Puis :
Copy code
Bash
df -h | egrep "AP02807|prod"
7ï¸âƒ£ Version â€œtexte prÃªt Ã  collerâ€ pour une DEMANDE (RITM)
Si tu veux, je peux te fournir :
âœ… une demande RITM prÃªte
âœ… un mail formel
âœ… un runbook PDF
âœ… une checklist N3 avant/aprÃ¨s
Dis-moi juste ce que tu veux comme format ğŸ˜‰


Parfait ğŸ‘
Voici comment ajouter proprement les entrÃ©es /etc/fstab pour un cluster Veritas (VxFS), avec dossiers imbriquÃ©s, en respectant les bonnes pratiques VCS.
âš ï¸ Important (cluster Veritas)
ğŸ‘‰ Le montage est pilotÃ© par VCS, pas par le boot Linux
ğŸ‘‰ Donc noauto est OBLIGATOIRE
ğŸ‘‰ /etc/fstab sert surtout de rÃ©fÃ©rence systÃ¨me / secours
ğŸ”‘ RÃ¨gles FSTAB en cluster Veritas
Toujours utiliser le device VxVM
/dev/vx/dsk/<dg>/<vol>
Toujours mettre :
vxfs
noauto
Pas de fsck automatique â†’ 0 0
ğŸ“Œ Exemple COMPLET â€“ dg_prod1_pkg2 (prod1)
Ã€ ajouter sur les deux nÅ“uds :
Copy code
Fstab
# === PROD1 - dg_prod1_pkg2 ===
/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms        /applis/AP02807-ATP00_comms/prod1-comms               vxfs  noauto  0 0
/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms_logs   /applis/AP02807-ATP00_comms/prod1-comms/logs          vxfs  noauto  0 0
/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_comms_data   /applis/AP02807-ATP00_comms/prod1-comms/data          vxfs  noauto  0 0

/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_itrp         /applis/AP02807-ATP00_phalanger/storage_prod1_itrp    vxfs  noauto  0 0

/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_batch        /applis/AP02807-ATP00_batch/prod1-batch               vxfs  noauto  0 0
/dev/vx/dsk/dg_prod1_pkg2/vol_prod1_batch_logs   /applis/AP02807-ATP00_batch/prod1-batch/logs          vxfs  noauto  0 0
ğŸ“Œ Exemple COMPLET â€“ dg_prod3_pkg5 (prod3)
Copy code
Fstab
# === PROD3 - dg_prod3_pkg5 ===
/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_comms        /applis/AP02807-ATP00_comms/prod3-comms               vxfs  noauto  0 0
/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_comms_logs   /applis/AP02807-ATP00_comms/prod3-comms/logs          vxfs  noauto  0 0
/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_comms_data   /applis/AP02807-ATP00_comms/prod3-comms/data          vxfs  noauto  0 0

/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_itrp         /applis/AP02807-ATP00_phalanger/storage_prod3_itrp    vxfs  noauto  0 0

/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_batch        /applis/AP02807-ATP00_batch/prod3-batch               vxfs  noauto  0 0
/dev/vx/dsk/dg_prod3_pkg5/vol_prod3_batch_logs   /applis/AP02807-ATP00_batch/prod3-batch/logs          vxfs  noauto  0 0
ğŸ§  Bonnes pratiques N3 (important)
âœ… Ã€ FAIRE
MÃªme /etc/fstab sur tous les nÅ“uds
Commenter clairement chaque bloc
VÃ©rifier les dossiers existent :
Copy code
Bash
ls -ld /applis/AP02807*
âŒ Ã€ NE JAMAIS FAIRE
âŒ pas de defaults
âŒ pas de auto
âŒ pas de mount -a
âŒ pas de montage hors VCS
ğŸ” VÃ©rification finale
Copy code
Bash
grep AP02807 /etc/fstab
Puis laisser VCS gÃ©rer les montages :
Copy code
Bash
hagrp -online acetp_prodX_pkgY-SG -sys <node>
Si tu veux, je peux te fournir :
ğŸ§¾ fstab â€œgold templateâ€ cluster
ğŸ“‹ checklist audit fstab Veritas
ğŸ¤– script auto-gÃ©nÃ©ration fstab depuis un tableau
Dis-moi ğŸ‘